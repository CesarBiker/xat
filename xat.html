<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/font-awesome-4.5.0/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="css/xat.css">
        <link rel="stylesheet" type="text/css" href="css/config.css">
        
        <script src="js/jquery-1.12.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>

        <!-- Per el color picker -->
        <script src="js/spectrum.js"></script>
        <link rel="stylesheet" type="text/css" href="css/spectrum.css">

        <!-- Core xat -->
        <script src="js/socket.io-1.4.5.js"></script>
        <script src="js/controlXat.js"></script>

        <link rel="stylesheet" href="highlight/styles/monokai-sublime.css">
        <script src="highlight/highlight.pack.js"></script>

		<title>Chang</title>
	</head>
	<body onload="onLoadMain()">
        <!-- Navegador -->
        <nav class="navbar navbar-default navegador">
            <div class="container-fluid">
                <div class="navbar-header">
                
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button> 
                    <a class="navbar-brand" href="#">Chang</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                  <ul class="nav navbar-nav">
                    <li class="active"><a href="xat.html">Xat general <span class="badge" id="missatgesPerduts"></span></a></li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        Xats <span class="badge">15</span>
                             <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                              <li><a href="#">Sr. Ñor <span class="badge">5</span></a></li>
                              <li><a href="#">Dr. Trivial <span class="badge">10</span></a></li>
                        </ul>
                    </li>
                  </ul>
                  <ul class="nav navbar-nav navbar-right">
                    <li data-toggle="modal" data-target="#popup-configuracio"><a href="#"><i class="fa fa-cogs"></i> Configuració</a></li>
                    <li><a href="" onclick="desconectarse()"><i class="fa fa-sign-out"></i> Sortir</a></li>
                  </ul>
                </div>
            </div>
        </nav>


        <div class="contenidor">

            <!-- Usuaris conectats -->
            <div class="esquerra">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><i class="fa fa-user"></i> Usuaris conectats</h3>
                    </div>
                    <div class="panel-body">
                        <div class="list-group" id="usuaris">
                          <button type="button" class="list-group-item">Sr. Ñor</button>
                          <button type="button" class="list-group-item">Dr. Trivial</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estructura dels missatges -->
            <div class="dreta">
                <div class="missatgesXat"> 
                    <div class="panel panel-default panel-xat">
                        <div class="panel-heading">
                            <h3 class="panel-title">Xat general</h3>
                        </div>
                        <div  id="missatges" class="panel-body">
                            <!-- Antiga estructura:
                            <div class="missatge">
                                <div class="cont">
                                    <p class="autor">asd</p>
                                    <p class="text">asdasd</p>
                                </div>
                            </div> 
                            -->
                            <!-- Nova estructura: 
                            <div class="panel panel-default panel-missatge">
                                <div class="panel-body missatge" >
                                    <p class="autor"><b>Charly</b></p>
                                    <p class="text">hehe</p>
                                    <p class="hora">13:37</p>
                                </div>
                            </div>
                            -->
                        </div>
                    </div>
                </div>
                <div class="zonaEnviar"> 
                    <div class="input-group input-group-lg gran-50">
                        <div class="input-group-btn dropup gran-50">
                            <button type="button" class="btn  btn-default dropdown-toggle gran-50 no-bordes" 
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="glyphicon glyphicon-paperclip"></span>
                            </button>
                            <ul class="dropdown-menu ">
                              <li class="disabled"><a href="#"><i class="fa fa-file"></i> Enviar arxiu</a></li>
                              <li role="separator" class="divider"></li>
                              <li class="disabled"><a href="#"><i class="fa fa-camera"></i> Enviar imatge</a></li>
                              <li role="separator" class="divider"></li>
                              <li data-toggle="modal" data-target="#insertar-codi" ><a href="#"><i class="fa fa-code"></i> Insertar codi</a></li>
                            </ul>
                        </div>
                        <input id="text" onkeypress="testKey(event)" type="text" class="form-control gran-50" placeholder="Insereix el text que vulguis enviar" autocomplete="off">
                        <span class="input-group-btn">
                            <button class="btn btn-default gran-50 no-bordes pop-icones" type="button" data-container="body" data-toggle="popover" data-placement="top" data-original-title="" title="" >   
                            <i class="fa fa-smile-o"></i>
                            </button>
                              
                        </span>
                    </div>
                </div>
            </div>
            <div style="clear:both;"/>

            <!-- Modals (popup's) -->

            <!-- Insertar codi... -->
            <div class="modal fade" id="insertar-codi" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> 
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Insereix el codi que vulguis enviar</h4>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label for="tipus-codi" class="control-label">Llenguatge:</label>
                                    <input placeholder="Auto , Bash, C#, C++, CSS, HTML, XML, HTTP, Java, JavaScript, Objective-C, PHP, SQL, etc." type="text" class="form-control" id="tipus-codi">
                                </div>
                                <div class="form-group">
                                    <label for="codi-a-enviar" class="control-label">Codi:</label>
                                    <textarea class="form-control" id="codi-a-enviar"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer"> 
                            <button type="button" class="btn btn-default" data-dismiss="modal">Tancar</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="enviarCodi()">Enviar codi</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuració... -->
            <div class="modal fade" id="popup-configuracio" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> 
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Configuració del compte</h4>
                        </div>
                        <div class="modal-body">
                            <input id="nou-nick" type="text" class="form-control" aria-label="..." placeholder="Nou nick" autocomplete="off">
                            <input type='text' id="paleta-colors"/>
                            <input id="nova-pass1" class="form-control" aria-label="..." placeholder="Nova contrasenya" type="password" autocomplete="off" >
                            <input id="nova-pass2" class="form-control" aria-label="..." placeholder="Repeteix la contrasenya" type="password" autocomplete="off" >
                            
                            <input id="actual-pass" class="form-control" aria-label="..." placeholder="Contrasenya actual" type="password" autocomplete="off" required>

                            <button id="enviar" onclick="configClick()" type="button" class="btn btn-success guardar-canvis">Guardar canvis</button>
                            <div id="msg-info" class="alert alert-info" role="alert">Per a quelsevol modificació has d'introduïr la teva contrasenya actual</div>
                            <!--
                            <div class="alert alert-success" role="alert"><b>Success:</b> Els canvis s'han actualitzat correctament</div>
                            <div class="alert alert-danger" role="alert"><b>Error:</b> aquest nick ja existeix</div> -->
                        </div>
                    
                    </div>
                </div>
            </div>
            <!-- Icones... -->

            <div id="conjunt-icones" style="display: none; ">
                
            </div>
        </div>
	</body>
</html>

<script type="text/javascript"> 
// Per el popover de les icones (fa que no es tanqui mentre tinguem el hover dins el recuadre)
// i també per afegir el div de icones!
$(".pop-icones").popover({ trigger: "manual" , html: true, animation:false,
    content: function() {
        return $('#conjunt-icones').html();
    }}).on("mouseenter", function () {
        var _this = this;
        $(this).popover("show");
        $(".popover").on("mouseleave", function () {
            $(_this).popover('hide');
        });
        $('[data-toggle="tooltip"]').tooltip();
    }).on("mouseleave", function () {
        var _this = this;
        setTimeout(function () {
            if (!$(".popover:hover").length) {
                $(_this).popover("hide");
            }
    }, 300);
});

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip(); 
}); 

$("#paleta-colors").spectrum({
    color: "#555", // Aquí es fica el color per defecte. Falta ficar el actual del user.
    showPaletteOnly: true,
    replacerClassName: 'form-control boto-paleta-fons',
    change: function(color) {
        $("#nou-nick").css('color', color),
        $("#nou-nick").css('border-color', color)
    },
    palette: [
        ["#A50000", "#FF0000","#FF4000","#FF8000","#80FF00","#40FF00","#00FF00",
        "#00FF80","#00FFBF","#00FFFF","#00BFFF","#0080FF","#0040FF","#0000FF", "#4000FF", "#035462", "#5F7CFF",
        "#8A60FF", "#33007F", "#FF75FA", "#5B0047","#FF3A57", "#E42B00", "#FF9200", "#BF9700", "#80B900", "#9CE000",
        "#349E5B",
        "#8000FF", "#740066", "#BF00FF", "#FF00FF", "#FF0080", "#FF0040", "#555", "#000000"]
    ]
});

function configClick() {
    var actualPass=$('#actual-pass').val();
    if (actualPass === '') {
        nouMsgInfo('danger', '<b>Error:</b> Escriu la teva contrasenya actual');
        $('#actual-pass').focus();
        return false;
    }
    var novaPass1=$('#nova-pass1').val();
    var novaPass2=$('#nova-pass2').val();
    if (novaPass1 !== novaPass2) { /* També ho agafa si deixa els dos en blanc i per tant no es vol canviar*/
        nouMsgInfo('danger', '<b>Error:</b> Has d\'escriure la nova contrasenya dos cops iguals!');
        return false;
    };
    var nouNick=$('#nou-nick').val();
    var color=$('#paleta-colors').spectrum("get").toHexString();

    /* Quan estigui tot be... */
    var enviar = new XMLHttpRequest();
    enviar.onreadystatechange = function() {
        if(enviar.readyState == 4 && enviar.status == 200) {
            console.log(enviar.responseText);
            if(enviar.responseText.split(',')[0] === "true") {
                nouMsgInfo('success', '<b>Enhorabona:</b> ' + enviar.responseText.split(',')[1]);            
            } else {
                nouMsgInfo('danger', enviar.responseText.split(',')[1]);
            }
        }
    };
    enviar.open("POST", "f.php", true);
    enviar.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    if(novaPass1 !== '')
        novaPass1 = waw(novaPass1);
    enviar.send("u=&pass=" + waw(actualPass) + "&novaPass=" + novaPass1 + "&nick=" + nouNick + "&color=" + color + "&cookie=" + getCookie('login'));

}
function nouMsgInfo(tipus, missatge) { /* missatge informació configuració. tipus: info, success, danger */
    var msg = document.getElementById("msg-info");
    msg.className = "alert alert-"+tipus;
    if(tipus === "danger")
        msg.innerHTML = "<b>Error:</b> " + missatge;
    else
        msg.innerHTML = missatge;
}


var _0x6928=["","\x6C\x65\x6E\x67\x74\x68","\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74","\x70\x75\x73\x68","\x74\x6F\x4C\x6F\x77\x65\x72\x43\x61\x73\x65"];
function waw(_0xfb66x2){var _0xfb66x3=function(_0xfb66x4,_0xfb66x5){var _0xfb66x6=(_0xfb66x4<<_0xfb66x5)|(_0xfb66x4>>>(32-_0xfb66x5));return _0xfb66x6};var _0xfb66x7=function(_0xfb66x8){var _0xfb66x2=_0x6928[0];var _0xfb66x9;var _0xfb66xa;for(_0xfb66x9=7;_0xfb66x9>=0;_0xfb66x9--){_0xfb66xa=(_0xfb66x8>>>(_0xfb66x9*4))&0x0f;_0xfb66x2+=_0xfb66xa.toString(16)};return _0xfb66x2};var _0xfb66xb;var _0xfb66x9,_0xfb66xc;var _0xfb66xd= new Array(80);var _0xfb66xe=0x67452301;var _0xfb66xf=0xEFCDAB89;var _0xfb66x10=0x98BADCFE;var _0xfb66x11=0x10325476;var _0xfb66x12=0xC3D2E1F0;var _0xfb66x13,_0xfb66x14,_0xfb66x15,_0xfb66x16,_0xfb66x17;var _0xfb66x18;_0xfb66x2=unescape(encodeURIComponent(_0xfb66x2));var _0xfb66x19=_0xfb66x2[_0x6928[1]];var _0xfb66x1a=[];for(_0xfb66x9=0;_0xfb66x9<_0xfb66x19-3;_0xfb66x9+=4){_0xfb66xc=_0xfb66x2[_0x6928[2]](_0xfb66x9)<<24|_0xfb66x2[_0x6928[2]](_0xfb66x9+1)<<16|_0xfb66x2[_0x6928[2]](_0xfb66x9+2)<<8|_0xfb66x2[_0x6928[2]](_0xfb66x9+3);_0xfb66x1a[_0x6928[3]](_0xfb66xc)};switch(_0xfb66x19%4){case 0:_0xfb66x9=0x080000000;break;case 1:_0xfb66x9=_0xfb66x2[_0x6928[2]](_0xfb66x19-1)<<24|0x0800000;break;case 2:_0xfb66x9=_0xfb66x2[_0x6928[2]](_0xfb66x19-2)<<24|_0xfb66x2[_0x6928[2]](_0xfb66x19-1)<<16|0x08000;break;case 3:_0xfb66x9=_0xfb66x2[_0x6928[2]](_0xfb66x19-3)<<24|_0xfb66x2[_0x6928[2]](_0xfb66x19-2)<<16|_0xfb66x2[_0x6928[2]](_0xfb66x19-1)<<8|0x80;break};_0xfb66x1a[_0x6928[3]](_0xfb66x9);while((_0xfb66x1a[_0x6928[1]]%16)!=14){_0xfb66x1a[_0x6928[3]](0)};_0xfb66x1a[_0x6928[3]](_0xfb66x19>>>29);_0xfb66x1a[_0x6928[3]]((_0xfb66x19<<3)&0x0ffffffff);for(_0xfb66xb=0;_0xfb66xb<_0xfb66x1a[_0x6928[1]];_0xfb66xb+=16){for(_0xfb66x9=0;_0xfb66x9<16;_0xfb66x9++){_0xfb66xd[_0xfb66x9]=_0xfb66x1a[_0xfb66xb+_0xfb66x9]};for(_0xfb66x9=16;_0xfb66x9<=79;_0xfb66x9++){_0xfb66xd[_0xfb66x9]=_0xfb66x3(_0xfb66xd[_0xfb66x9-3]^_0xfb66xd[_0xfb66x9-8]^_0xfb66xd[_0xfb66x9-14]^_0xfb66xd[_0xfb66x9-16],1)};_0xfb66x13=_0xfb66xe;_0xfb66x14=_0xfb66xf;_0xfb66x15=_0xfb66x10;_0xfb66x16=_0xfb66x11;_0xfb66x17=_0xfb66x12;for(_0xfb66x9=0;_0xfb66x9<=19;_0xfb66x9++){_0xfb66x18=(_0xfb66x3(_0xfb66x13,5)+((_0xfb66x14&_0xfb66x15)|(~_0xfb66x14&_0xfb66x16))+_0xfb66x17+_0xfb66xd[_0xfb66x9]+0x5A827999)&0x0ffffffff;_0xfb66x17=_0xfb66x16;_0xfb66x16=_0xfb66x15;_0xfb66x15=_0xfb66x3(_0xfb66x14,30);_0xfb66x14=_0xfb66x13;_0xfb66x13=_0xfb66x18};for(_0xfb66x9=20;_0xfb66x9<=39;_0xfb66x9++){_0xfb66x18=(_0xfb66x3(_0xfb66x13,5)+(_0xfb66x14^_0xfb66x15^_0xfb66x16)+_0xfb66x17+_0xfb66xd[_0xfb66x9]+0x6ED9EBA1)&0x0ffffffff;_0xfb66x17=_0xfb66x16;_0xfb66x16=_0xfb66x15;_0xfb66x15=_0xfb66x3(_0xfb66x14,30);_0xfb66x14=_0xfb66x13;_0xfb66x13=_0xfb66x18};for(_0xfb66x9=40;_0xfb66x9<=59;_0xfb66x9++){_0xfb66x18=(_0xfb66x3(_0xfb66x13,5)+((_0xfb66x14&_0xfb66x15)|(_0xfb66x14&_0xfb66x16)|(_0xfb66x15&_0xfb66x16))+_0xfb66x17+_0xfb66xd[_0xfb66x9]+0x8F1BBCDC)&0x0ffffffff;_0xfb66x17=_0xfb66x16;_0xfb66x16=_0xfb66x15;_0xfb66x15=_0xfb66x3(_0xfb66x14,30);_0xfb66x14=_0xfb66x13;_0xfb66x13=_0xfb66x18};for(_0xfb66x9=60;_0xfb66x9<=79;_0xfb66x9++){_0xfb66x18=(_0xfb66x3(_0xfb66x13,5)+(_0xfb66x14^_0xfb66x15^_0xfb66x16)+_0xfb66x17+_0xfb66xd[_0xfb66x9]+0xCA62C1D6)&0x0ffffffff;_0xfb66x17=_0xfb66x16;_0xfb66x16=_0xfb66x15;_0xfb66x15=_0xfb66x3(_0xfb66x14,30);_0xfb66x14=_0xfb66x13;_0xfb66x13=_0xfb66x18};_0xfb66xe=(_0xfb66xe+_0xfb66x13)&0x0ffffffff;_0xfb66xf=(_0xfb66xf+_0xfb66x14)&0x0ffffffff;_0xfb66x10=(_0xfb66x10+_0xfb66x15)&0x0ffffffff;_0xfb66x11=(_0xfb66x11+_0xfb66x16)&0x0ffffffff;_0xfb66x12=(_0xfb66x12+_0xfb66x17)&0x0ffffffff};_0xfb66x18=_0xfb66x7(_0xfb66xe)+_0xfb66x7(_0xfb66xf)+_0xfb66x7(_0xfb66x10)+_0xfb66x7(_0xfb66x11)+_0xfb66x7(_0xfb66x12);return _0xfb66x18[_0x6928[4]]()
}
</script>